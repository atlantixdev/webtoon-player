<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Webtoon Creator and Player</title>
    <style>
        body { font-family: sans-serif; display: flex; height: 100vh; margin: 0; }
        #creator-panel { width: 300px; padding: 20px; border-right: 1px solid #ccc; overflow-y: auto; }
        #player-panel { flex-grow: 1; position: relative; display: flex; justify-content: center; align-items: center; background: #f0f0f0; }
        #player-image { max-width: 100%; max-height: 100%; }
        .panel-item { display: flex; align-items: center; margin-bottom: 10px; }
        .panel-item img { width: 50px; height: 50px; margin-right: 10px; }
        .panel-controls { display: flex; flex-direction: column; }
        .nav-buttons { position: absolute; bottom: 20px; left: 50%; transform: translateX(-50%); }
        .progress-bar { position: absolute; bottom: 0; left: 0; width: 100%; height: 5px; background: #ccc; }
        .progress { height: 100%; background: #007bff; }
        canvas { position: absolute; top: 0; left: 0; pointer-events: none; }
        .word-balloon { position: absolute; background: white; border-radius: 50%; padding: 10px; border: 2px solid black; font-family: 'Bangers', cursive; }
    </style>
    <link href="https://fonts.googleapis.com/css2?family=Bangers&display=swap" rel="stylesheet">
</head>
<body>

    <div id="creator-panel">
        <h2>Webtoon Creator</h2>
        <button id="new-project-btn">New Project</button>
        <button id="my-webtoons-btn">My Webtoons</button>
        <hr>
        <input type="text" id="webtoon-title" placeholder="Webtoon Title">
        <input type="file" id="image-upload" multiple accept="image/*">
        <div id="panel-list"></div>
        <button id="save-webtoon-btn">Save Webtoon</button>
        <div id="embed-code-container" style="display:none;">
            <h3>Embed Code</h3>
            <textarea id="embed-code" readonly rows="4" style="width:100%;"></textarea>
        </div>
    </div>

    <div id="player-panel">
        <img id="player-image" src="" alt="Webtoon Panel">
        <canvas id="effects-canvas"></canvas>
        <div id="balloons-container"></div>
        <div class="nav-buttons">
            <button id="prev-btn">Previous</button>
            <button id="next-btn">Next</button>
        </div>
        <div class="progress-bar">
            <div id="progress" class="progress"></div>
        </div>
    </div>

    <div id="my-webtoons-modal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); justify-content:center; align-items:center;">
        <div style="background:white; padding:20px; border-radius:5px;">
            <h3>My Webtoons</h3>
            <ul id="webtoon-projects-list"></ul>
            <button id="close-modal-btn">Close</button>
        </div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.7.77/Tone.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/interactjs/dist/interact.min.js"></script>

    <script>
        // Your Firebase configuration
        const firebaseConfig = {
            apiKey: "YOUR_API_KEY",
            authDomain: "YOUR_AUTH_DOMAIN",
            projectId: "YOUR_PROJECT_ID",
            storageBucket: "YOUR_STORAGE_BUCKET",
            messagingSenderId: "YOUR_MESSAGING_SENDER_ID",
            appId: "YOUR_APP_ID"
        };

        // Initialize Firebase
        const app = firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        let panels = [];
        let currentPanelIndex = 0;
        let currentBalloonIndex = -1;
        let currentProjectId = null;

        const creatorPanel = document.getElementById('creator-panel');
        const playerPanel = document.getElementById('player-panel');
        const imageUpload = document.getElementById('image-upload');
        const panelList = document.getElementById('panel-list');
        const playerImage = document.getElementById('player-image');
        const prevBtn = document.getElementById('prev-btn');
        const nextBtn = document.getElementById('next-btn');
        const progress = document.getElementById('progress');
        const effectsCanvas = document.getElementById('effects-canvas');
        const ctx = effectsCanvas.getContext('2d');
        const saveWebtoonBtn = document.getElementById('save-webtoon-btn');
        const embedCodeContainer = document.getElementById('embed-code-container');
        const embedCode = document.getElementById('embed-code');
        const webtoonTitle = document.getElementById('webtoon-title');
        const balloonsContainer = document.getElementById('balloons-container');
        const newProjectBtn = document.getElementById('new-project-btn');
        const myWebtoonsBtn = document.getElementById('my-webtoons-btn');
        const myWebtoonsModal = document.getElementById('my-webtoons-modal');
        const webtoonProjectsList = document.getElementById('webtoon-projects-list');
        const closeModalBtn = document.getElementById('close-modal-btn');

        // Check for player mode from URL
        const urlParams = new URLSearchParams(window.location.search);
        const webtoonId = urlParams.get('webtoonId');
        if (webtoonId) {
            creatorPanel.style.display = 'none';
            loadWebtoon(webtoonId);
        }

        imageUpload.addEventListener('change', (e) => {
            for (const file of e.target.files) {
                const reader = new FileReader();
                reader.onload = (event) => {